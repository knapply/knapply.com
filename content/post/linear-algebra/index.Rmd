---
title: Linear Algebra
author: Brendan Knapp
date: '2018-12-02'
slug: index
categories:
  - data-science-notes
tags:
  - data-science-notes
  - statistics
  - programming
  - r
  - python
  - rcpp
image:
  caption: ''
  focal_point: 'Top'
summary: 'Common linear algebra operations.'
output:
  blogdown::html_page:
    toc: true
    toc_depth: 2
citation_url: https://knapply.com/post/linear-algebra/
editor_options: 
  chunk_output_type: console
---

> _This post was last updated on `r format(Sys.Date(), "%Y-%m-%d")`._

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = FALSE, comment = "#>", message = FALSE, warning = FALSE)

options(width=90)

source(here::here("static/R/html-helpers.R"))
# source(here::here("static/R/citation.R"))
source(here::here("static/R/wrangle_plot_save.R"))
```


```{r, eval = FALSE, echo=FALSE}
as_latex_matrix <- function(x, append = "") {
  stopifnot(is.matrix(x))
  apply(x, 1, function(y) {
    cat(paste0(y, glue::glue(" {append}"), collapse = "  &  "), 
              "\\\\\n")
  })
  invisible(NULL)
}
as_latex_matrix(2 * r_mat)

as_latex_matrix(r_mat, "\\cdot 2")
```


# Setup

```{r}
library(reticulate)
```


## R

### Base R



```{r}
r_mat <- matrix(c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                nrow = 3, ncol = 3)

r_mat
```

## Python

### NumPy

```{python}
import numpy as np

np_mat = np.array([[1, 4, 7],
                   [2, 5, 8],
                   [3, 6, 9]])

np_mat
```


<details>
<summary> Sanity Check </summary>
<p>

```{r}
stopifnot(
  all.equal(r_mat,
            py$np_mat)
  )
```

</p>
</details>


# Scalar Multiplication

$$
  2 
\cdot
\begin{bmatrix}
  1   &  4   &  7  \\
  2   &  5   &  8  \\
  3   &  6   &  9  \\
\end{bmatrix}
  =
\begin{bmatrix}
  1 \cdot 2  &  4 \cdot 2  &  7 \cdot 2 \\
  2 \cdot 2  &  5 \cdot 2  &  8 \cdot 2 \\
  3 \cdot 2  &  6 \cdot 2  &  9 \cdot 2 \\
\end{bmatrix}
  =
\begin{bmatrix}
  2   &  8   &  14  \\
  4   &  10   &  16  \\
  6   &  12   &  18  \\
\end{bmatrix}
$$




## R

### Base R

```{r}
r_res <- r_mat * 2
r_res
```

## Rcpp

### RcppArmadillo

```{Rcpp, cache=TRUE}
// [[Rcpp::plugins(cpp14)]]
// [[Rcpp::depends(RcppArmadillo)]]
#include <RcppArmadillo.h>
using namespace Rcpp;

// [[Rcpp::export]]
auto cpp_mat_dot_scalar(NumericMatrix x, int scalar) {
  auto arma_matrix = as<arma::mat>(x);
  auto out = arma_matrix * scalar;
  
  return wrap(out);
}
```

```{r}
cpp_arma_res <- cpp_mat_dot_scalar(r_mat, 2)
cpp_arma_res
```



## Python

### NumPy

```{python}
res = np_mat * 2
print(res)
```

<details>
<summary> Sanity Check </summary>
<p>

```{r}
stopifnot(
  all.equal(r_res,
            cpp_arma_res,
            py$res)
  )
```

</p>
</details>

# Matrix-Vector Multiplication

$$
\begin{bmatrix}
  [1,1]   &  [1,2]   &  [1,3]  \\
  [2,1]   &  [2,2]   &  [2,3]  \\
  [3,1]   &  [3,2]   &  [3,3]  \\
\end{bmatrix}
\cdot
\begin{bmatrix}
  a \\
  b \\
  c \\
\end{bmatrix} 
  =
\begin{bmatrix}
  [1,1] \cdot a + [1,2] \cdot b + [1,3] \cdot c \\
  [2,1] \cdot a + [2,2] \cdot b + [2,3] \cdot c \\
  [3,1] \cdot a + [3,2] \cdot b + [3,3] \cdot c \\
\end{bmatrix}
$$

$$
\begin{bmatrix}
  1   &  4   &  7  \\
  2   &  5   &  8  \\
  3   &  6   &  9  \\
\end{bmatrix}
\cdot
\begin{bmatrix}
  1 \\
  2 \\
  3 \\
\end{bmatrix} 
  \\=
\begin{bmatrix}
  1 \cdot 1 + 4 \cdot 2 + 7 \cdot 3 \\
  2 \cdot 1 + 5 \cdot 2 + 8 \cdot 3 \\
  3 \cdot 1 + 6 \cdot 2 + 9 \cdot 3 \\
\end{bmatrix}
  \\=
\begin{bmatrix}
  1 + 8 + 21 \\
  2 + 10 + 24 \\
  3 + 12 + 27 \\
\end{bmatrix}
  \\=
\begin{bmatrix}
  30  \\
  36  \\
  42  \\
\end{bmatrix}
$$

## R

### Base R

```{r}
r_res <- r_mat %*% c(1,
                     2,
                     3)
r_res
```

## Rcpp

### RcppArmadillo

```{Rcpp, cache = TRUE}
// [[Rcpp::plugins(cpp14)]]
// [[Rcpp::depends(RcppArmadillo)]]
#include <RcppArmadillo.h>
using namespace Rcpp;

// [[Rcpp::export]]
auto cpp_mat_dot_vec(NumericMatrix mat, NumericVector col_vec) {
  auto arma_mat = as<arma::mat>(mat);
  auto arma_vec = as<arma::colvec>(col_vec);
  
  auto out = arma_mat * arma_vec;
  
  return wrap(out);
}
```

```{r}
cpp_arma_res <- cpp_mat_dot_vec(r_mat, c(1, 
                                         2,
                                         3))
cpp_arma_res
```



## Python

### NumPy

```{python}
res = np_mat.dot(np.array([[1],
                           [2],
                           [3]]))
print(res)
```


<details>
<summary> Sanity Check </summary>
<p>

```{r}
stopifnot(
  all.equal(r_res,
            cpp_arma_res,
            py$res)
  )
```

</p>
</details>


# Vector-Matrix Multiplication

$$
\begin{bmatrix}
  a & b & c
\end{bmatrix}
\cdot
\begin{bmatrix}
  (1,1)   &  (1,2)   &  (1,3)  \\
  (2,1)   &  (2,2)   &  (2,3)  \\
  (3,1)   &  (3,2)   &  (3,3)  \\
\end{bmatrix}
\\\downarrow\\
\scriptsize{
\begin{bmatrix}a\cdot(1,1) + b\cdot(2,1) + c\cdot(3,1) & a\cdot(1,2) + b\cdot (2,2) + c\cdot(3,2) & a\cdot(1,3) + b\cdot(2,3) + c\cdot(3,3)\end{bmatrix}
}
$$

<br>

$$
\begin{bmatrix}
  1 & 2 & 3
\end{bmatrix}
\cdot
\begin{bmatrix}
  1   &  4   &  7  \\
  2   &  5   &  8  \\
  3   &  6   &  9  \\
\end{bmatrix}
\\\downarrow\\
\begin{bmatrix}
  1 \cdot 1 + 2 \cdot 2 + 3 \cdot 3 ~&~ 1 \cdot 4 + 2 \cdot 5 + 3 \cdot 6 ~&~ 1 \cdot 7 + 2 \cdot 8 + 3 \cdot 9
\end{bmatrix}
\\\downarrow\\
\begin{bmatrix}
  1 + 4 + 9 ~&~ 4 + 10 + 18 ~&~ 7 + 16 + 27
\end{bmatrix}
\\\downarrow\\
\begin{bmatrix}
14   &  32   &  50  \\
\end{bmatrix}
$$

## R

### Base R

```{r}
r_res <- c(1, 2, 3) %*% r_mat

r_res
```

## Rcpp

### RcppArmadillo

```{Rcpp, cache=TRUE}
// [[Rcpp::plugins(cpp14)]]
// [[Rcpp::depends(RcppArmadillo)]]
#include <RcppArmadillo.h>
using namespace Rcpp;

// [[Rcpp::export]]
auto cpp_vec_dot_mat(NumericVector row_vec, NumericMatrix mat) {
  auto arma_mat = as<arma::mat>(mat);
  auto arma_vec = as<arma::rowvec>(row_vec);
  
  auto out = arma_vec * arma_mat;
  
  return wrap(out);
}
```

```{r}
cpp_arma_res <- cpp_vec_dot_mat(
  c(1, 2, 3), r_mat
  )
cpp_arma_res
```



## Python

### NumPy

```{python}
res = np.array([[1, 2, 3]]).dot(np_mat)
print(res)
```


<details>
<summary> Sanity Check </summary>
<p>

```{r}
stopifnot(
  all.equal(r_res,
            cpp_arma_res,
            py$res)
  )
```

</p>
</details>


# Matrix-Matrix Multiplication


$$
\begin{bmatrix}
  (1,1)_a   &  (1,2)_a   &  (1,3)_a  \\
  (2,1)_a   &  (2,2)_a   &  (2,3)_a  \\
\end{bmatrix}
\cdot
\begin{bmatrix}
  (1,1)_b   &  (1,2)_b   &  (1,3)_b  \\
  (2,1)_b   &  (2,2)_b   &  (2,3)_b  \\
  (3,1)_b   &  (3,2)_b   &  (3,3)_b  \\
\end{bmatrix}
\\\downarrow\\
\tiny{
\begin{matrix}
  (1,1)_a\cdot(1,1)_b  +  (1,2)_a\cdot(2,1)_b  +  (1,3)_a\cdot(2,1)_b &
  (1,1)_a\cdot(1,2)_b  +  (1,2)_a\cdot(2,2)_b  +  (1,3)_a\cdot(3,2)_b &
  (1,1)_a\cdot(1,3)_b  +  (1,2)_a\cdot(2,3)_b  +  (1,3)_a\cdot(3,3)_b \\
  (2,1)_a\cdot(1,1)_b  +  (2,2)_a\cdot(2,1)_b  +  (2,3)_a\cdot(2,1)_b &
  (2,1)_a\cdot(1,2)_b  +  (2,2)_a\cdot(2,2)_b  +  (2,3)_a\cdot(3,2)_b &
  (2,1)_a\cdot(1,3)_b  +  (2,2)_a\cdot(2,3)_b  +  (2,3)_a\cdot(3,3)_b
\end{matrix}
}
$$

<br>

$$
\begin{bmatrix}
  1   &  2   &  3  \\
  4   &  5   &  6  \\
\end{bmatrix}
\cdot
\begin{bmatrix}
  1   &  4   &  7  \\
  2   &  5   &  8  \\
  3   &  6   &  9  \\
\end{bmatrix}
\\\downarrow\\
\begin{bmatrix}
  1\cdot1 + 2\cdot2 + 3\cdot3 ~&~ 1\cdot4 + 2\cdot5 + 3\cdot6 ~&~ 1\cdot7 + 2\cdot8 + 3\cdot9 \\
  4\cdot1 + 5\cdot2 + 6\cdot3 ~&~ 4\cdot4 + 5\cdot5 + 6\cdot6 ~&~ 4\cdot7 + 5\cdot8 + 6\cdot9 \\
\end{bmatrix}
\\\downarrow\\
\begin{bmatrix}
  1+4+9 ~&~ 4+10+18 ~&~ 7+16+27 \\
  4+10+18 ~&~ 16+25+36 ~&~ 28+40+54 \\
\end{bmatrix}
\\\downarrow\\
\begin{bmatrix}
  14   &  32   &  50  \\
  32   &  77   &  122  \\
\end{bmatrix}
$$

## R

### Base R

```{r}
r_mat2 <- t(r_mat[,1:2])
r_mat2
```


```{r}
r_res <- r_mat2 %*% r_mat
r_res
```


## Rcpp

### RcppArmadillo

```{Rcpp, cache=TRUE}
// [[Rcpp::plugins(cpp14)]]
// [[Rcpp::depends(RcppArmadillo)]]
#include <RcppArmadillo.h>
using namespace Rcpp;

// [[Rcpp::export]]
auto cpp_mat_dot_mat(NumericMatrix mat1, NumericMatrix mat2) {
  auto arma_mat1 = as<arma::mat>(mat1);
  auto arma_mat2 = as<arma::mat>(mat2);
  
  auto out = arma_mat1 * arma_mat2;
  
  return wrap(out);
}
```

```{r}
cpp_arma_res <- cpp_mat_dot_mat(r_mat2, r_mat)
cpp_arma_res
```


## Python

### NumPy

```{python}
np_mat2 = np_mat[:, 0:2].transpose()
print(np_mat2)
```

```{python}
res = np_mat2.dot(np_mat)
print(res)
```



<details>
<summary> Sanity Check </summary>
<p>

```{r}
stopifnot(
  all.equal(r_res,
            cpp_arma_res,
            py$res)
  )
```

</p>
</details>

# $|A|$: Determinant of a Matrix

## Breakdown

### $2 \times 2$ Matrix

$$
A = \begin{bmatrix}
  a & b \\
  c & d
\end{bmatrix}
$$

$$
\left| \begin{matrix}
  \color{red}a & & &  & \color{blue}b \\
  &  \color{red}\nwarrow & &  \color{blue}\nearrow \\
  & & \large\times & &  \\
  &  \color{blue}\swarrow & &  \color{red}\searrow \\
  \color{blue}c & & & & \color{red}d \\
\end{matrix} \right|
$$

$$
\\ \downarrow \\
|A| = \color{red}{ad} - \color{blue}{bc}
$$

### $3 \times 3$ Matrix

$$
A = \begin{bmatrix} a   &  b   &  c  \\
                    d   &  e   &  f  \\
                    g   &  h   &  i  \\ \end{bmatrix}\\
$$

Break it into three 2 x 2 matrices and recursively find their determinants.


$$
\begin{bmatrix}
  \color{green}{\Large{\textbf{a}}} & \scriptsize{\color{gray}b} & \scriptsize{\color{gray}c} \\
  \scriptsize{\color{gray}d} & \color{red}e & \color{blue}f \\
  \scriptsize{\color{gray}g} & \color{blue}h & \color{red}i
\end{bmatrix}
\LARGE{-}
\normalsize
\begin{bmatrix}
  \scriptsize{\color{gray}a} & \color{green}{\Large{\textbf{b}}} & \scriptsize{\color{gray}c} \\
  \color{red}d & \scriptsize{\color{gray}e} & \color{blue}f \\
  \color{blue}g & \scriptsize{\color{gray}h} & \color{red}i
\end{bmatrix}
\LARGE+
\normalsize
\begin{bmatrix}
  \scriptsize{\color{gray}a} & \scriptsize{\color{gray}b} & \color{green}{\Large{\textbf{c}}} \\
  \color{red}d & \color{blue}e & \scriptsize{\color{gray}f} \\
  \color{blue}g & \color{red}h & \scriptsize{\color{gray}i}
\end{bmatrix}
$$

<br>

$$
|A| = \color{green}a \cdot \left| \begin{matrix} \color{red}e & \color{blue}f \\ \color{blue}h & \color{red}i \\ \end{matrix} \right| - \color{green}b \cdot \left| \begin{matrix} \color{red}d & \color{blue}f \\\color{blue}g & \color{red}h \\ \end{matrix}\right| - \color{green}c \cdot \left| \begin{matrix} \color{red}d & \color{blue}e \\ \color{blue}g & \color{red}h \\ \end{matrix}\right|
\\ \downarrow \\
\color{green}a(\color{red}{ei} - \color{blue}{fh}) - \color{green}b(\color{red}{dh} - \color{blue}{fg}) - \color{green}c(\color{red}{dh} - \color{blue}{eg})
$$

## Example

$$
  A = 
\begin{bmatrix}
  6   &   1   &  1  \\
  4   &  \text{-}2   &  5  \\
  2   &   8   &  7  \\
\end{bmatrix}
$$

$$
|A| = \color{green}6 \cdot \left| \begin{matrix} \color{red}{\text{-}2} & \color{blue}5 \\ \color{blue}8 & \color{red}7 \\ \end{matrix} \right|- \color{green}1 \cdot\left|\begin{matrix}\color{red}4 & \color{blue}5 \\\color{blue}2 & \color{red}7 \\ \end{matrix}\right|- \color{green}1 \cdot\left|\begin{matrix}\color{red}4 & \color{blue}{\text{-}2} \\\color{blue}2 & \color{red}8 \\ \end{matrix}\right| \\
\\ \downarrow \\
\color{green}6(\color{red}{\text{-}2}\times \color{red}7 - \color{blue}5\times \color{blue}8) - \color{green}1(\color{red}4\times \color{red}7 - \color{blue}5\times \color{blue}2) - \color{green}1(\color{red}4\times \color{red}8 - \color{blue}{\text{-}2} \times \color{blue}2)
\\ \downarrow \\
\color{green}6(\color{red}{\text{-}14} - \color{blue}{40}) - \color{green}1(\color{red}{28} - \color{blue}{10}) - \color{green}1(\color{red}{32} - \color{blue}{\text{-}4})
\\ \downarrow \\
\color{green}6\times \color{purple}{\text{-}54} - \color{green}1\times \color{purple}{18} - \color{green}1 \times \color{purple}{\text{-}36}
\\ \downarrow \\
\text{-}324 - 18 + 36
\\ \downarrow \\
\text{-}306
$$


### $4 \times 4$ Matrix (and Beyond)

$$
A = \begin{bmatrix} a   &  b   &  c  &  d  \\
                    e   &  f   &  g  &  h  \\
                    i   &  j   &  k  &  l  \\
                    m   &  n   &  o  &  p  \\
    \end{bmatrix}\\
$$

Break it into four $3 \times 3$ matrices...

$$
\small
\begin{bmatrix} 
  \color{darkorange}{\textbf{a}} & \tiny{\color{lightgray}b} & \tiny{\color{lightgray}c} & \tiny{\color{lightgray}d}  \\
  \tiny{\color{lightgray}e}   &  \color{green}f   &  \color{green}g  &  \color{green}h  \\
  \tiny{\color{lightgray}i}   &  j   &  k  &  l  \\
  \tiny{\color{lightgray}m}   &  n   &  o  &  p  \\
\end{bmatrix}
~~
\begin{bmatrix} 
  \tiny{\color{lightgray}a} & \color{darkorange}{\textbf{b}} & \tiny{\color{lightgray}c} & \tiny{\color{lightgray}d}  \\
  \color{green}e   &  \tiny{\color{lightgray}f}   &  \color{green}g  &  \color{green}h  \\
  i   &  \tiny{\color{lightgray}j}  &  k  &  l  \\
  m   &  \tiny{\color{lightgray}n}   &  o  &  p  \\
\end{bmatrix}
~~
\begin{bmatrix} 
  \tiny{\color{lightgray}a} & \tiny{\color{lightgray}b} & \color{darkorange}{\textbf{c}}  & \tiny{\color{lightgray}d}  \\
  \color{green}e   &  \color{green}f  & \tiny{\color{lightgray}g}  &  \color{green}h  \\
  i   &  j  & \tiny{\color{lightgray}k}  &  l  \\
  m   &  n  & \tiny{\color{lightgray}o}  &  p  \\
\end{bmatrix}
~~
\begin{bmatrix} 
  \tiny{\color{lightgray}a} & \tiny{\color{lightgray}b} & \tiny{\color{lightgray}c} & \color{darkorange}{\textbf{d}}  \\
  \color{green}e   &  \color{green}f  &  \color{green}g & \tiny{\color{lightgray}h} \\
  i   &  j  &  k & \tiny{\color{lightgray}l} \\
  m   &  n  &  o  &  \tiny{\color{lightgray}p}
\end{bmatrix}
$$

... then break those into twelve $2 \times 2$ matrices, recursively finding their determinants (minors).

$$
\small
|A| = \color{darkorange}a \cdot \left| \begin{matrix} 
  \color{green}f & \color{green}g & \color{green}h \\
  j & k & l \\
  n & o & p \end{matrix} \right| -
\color{darkorange}b \cdot \left| \begin{matrix} 
  \color{green}e & \color{green}g & \color{green}h \\
  i & k & l \\
  m & o & p \end{matrix} \right| +
\color{darkorange}c \cdot \left| \begin{matrix} 
  \color{green}e & \color{green}f & \color{green}h \\
  i & j & l \\
  m & n & p \end{matrix} \right| -
\color{darkorange}d \cdot \left| \begin{matrix} 
  \color{green}e & \color{green}f & \color{green}g \\
  i & j & k \\
  m & n & o \end{matrix} \right|
\\ \LARGE \downarrow \\
\scriptsize
\color{darkorange}a \cdot 
\left(
\begin{array}{cc}
\begin{bmatrix}
\color{green}f & \tiny{\color{lightgray}g} & \tiny{\color{lightgray}h} \\
\tiny{\color{lightgray}j} & \color{red}k & \color{blue}l \\
\tiny{\color{lightgray}n} & \color{blue}o & \color{red}p \\
\end{bmatrix} \\ - \\
\begin{bmatrix}
  \tiny{\color{lightgray}f} & \color{green}g  & \tiny{\color{lightgray}h} \\
  \color{red}j & \tiny{\color{lightgray}k} & \color{blue}l \\
  \color{blue}n & \tiny{\color{lightgray}o} & \color{red}p \\
\end{bmatrix} \\ + \\
\begin{bmatrix}
  \tiny{\color{lightgray}f} & \tiny{\color{lightgray}g}  & \color{green}h \\
  \color{red}j & \tiny{\color{lightgray}k} & \color{blue}l \\
  \color{blue}n & \tiny{\color{lightgray}o} & \color{red}p \\
\end{bmatrix}
\end{array}
\right) -
\color{darkorange}b \cdot 
\left(
\begin{array}{cc}
\begin{bmatrix}
\color{green}e & \tiny{\color{lightgray}g} & \tiny{\color{lightgray}h} \\
\tiny{\color{lightgray}i} & \color{red}k & \color{blue}l \\
\tiny{\color{lightgray}m} & \color{blue}o & \color{red}p \\
\end{bmatrix} \\ - \\
\begin{bmatrix}
  \tiny{\color{lightgray}f} & \color{green}g  & \tiny{\color{lightgray}h} \\
  \color{red}i & \tiny{\color{lightgray}k} & \color{blue}l \\
  \color{blue}m & \tiny{\color{lightgray}o} & \color{red}p \\
\end{bmatrix} \\ + \\
\begin{bmatrix}
  \tiny{\color{lightgray}f} & \tiny{\color{lightgray}g}  & \color{green}h \\
  \color{red}i & \color{blue}k & \tiny{\color{lightgray}l} \\
  \color{blue}m & \color{red}o & \tiny{\color{lightgray}p} \\
\end{bmatrix}
\end{array}
\right) +
\color{darkorange}c \cdot 
\left(
\begin{array}{cc}
\begin{bmatrix}
\color{green}e & \tiny{\color{lightgray}f} & \tiny{\color{lightgray}h} \\
\tiny{\color{lightgray}i} & \color{red}j & \color{blue}l \\
\tiny{\color{lightgray}m} & \color{blue}n & \color{red}p \\
\end{bmatrix} \\ - \\
\begin{bmatrix}
  \tiny{\color{lightgray}f} & \color{green}f  & \tiny{\color{lightgray}h} \\
  \color{red}i & \tiny{\color{lightgray}j} & \color{blue}l \\
  \color{blue}m & \tiny{\color{lightgray}n} & \color{red}p \\
\end{bmatrix} \\ + \\
\begin{bmatrix}
  \tiny{\color{lightgray}f} & \tiny{\color{lightgray}f}  & \color{green}h \\
  \color{red}i & \color{blue}j & \tiny{\color{lightgray}l} \\
  \color{blue}m & \color{red}n & \tiny{\color{lightgray}p} \\
\end{bmatrix}
\end{array}
\right) -
\color{darkorange}d \cdot 
\left(
\begin{array}{cc}
\begin{bmatrix}
\color{green}e & \tiny{\color{lightgray}f} & \tiny{\color{lightgray}g} \\
\tiny{\color{lightgray}i} & \color{red}j & \color{blue}k \\
\tiny{\color{lightgray}m} & \color{blue}n & \color{red}o \\
\end{bmatrix} \\ - \\
\begin{bmatrix}
  \tiny{\color{lightgray}e} & \color{green}f  & \tiny{\color{lightgray}g} \\
  \color{red}i & \tiny{\color{lightgray}j} & \color{blue}k \\
  \color{blue}m & \tiny{\color{lightgray}n} & \color{red}o \\
\end{bmatrix} \\ + \\
\begin{bmatrix}
  \tiny{\color{lightgray}e} & \tiny{\color{lightgray}f}  & \color{green}g \\
  \color{red}i & \color{blue}j & \tiny{\color{lightgray}k} \\
  \color{blue}m & \color{red}n & \tiny{\color{lightgray}o} \\
\end{bmatrix}
\end{array}
\right)
\\ \LARGE \downarrow \\
\scriptsize
\color{darkorange}a \cdot
\left(
\begin{array}{cc}
\color{green}f \cdot
\left| \begin{matrix} 
  \color{red}k & \color{blue}l \\
  \color{blue}o & \color{red}p \\
\end{matrix} \right| \\-\\
\color{green}g \cdot
\left| \begin{matrix} 
  \color{red}j & \color{blue}l \\
  \color{blue}n & \color{red}p \\
\end{matrix} \right| \\+\\
\color{green}h \cdot
\left| \begin{matrix} 
  \color{red}j & \color{blue}k \\
  \color{blue}n & \color{red}o \\
\end{matrix} \right|
\end{array}
\right)
-
\color{darkorange}b \cdot
\left(
\begin{array}{cc}
\color{green}e \cdot
\left| \begin{matrix} 
  \color{red}k & \color{blue}l \\
  \color{blue}o & \color{red}p \\
\end{matrix} \right|
\\-\\
\color{green}g \cdot
\left| \begin{matrix} 
  \color{red}i & \color{blue}l \\
  \color{blue}m & \color{red}p \\
\end{matrix} \right|
\\+\\
\color{green}h \cdot
\left| \begin{matrix} 
  \color{red}i & \color{blue}k \\
  \color{blue}m & \color{red}o \\
\end{matrix} \right|
\end{array}
\right) +
\color{darkorange}c \cdot
\left(
\begin{array}{cc}
\color{green}e \cdot
\left| \begin{matrix} 
  \color{red}j & \color{blue}l \\
  \color{blue}n & \color{red}p \\
\end{matrix} \right| \\-\\
\color{green}f \cdot
\left| \begin{matrix} 
  \color{red}i & \color{blue}l \\
  \color{blue}m & \color{red}p \\
\end{matrix} \right| \\+\\
\color{green}h \cdot
\left| \begin{matrix} 
  \color{red}i & \color{blue}j \\
  \color{blue}m & \color{red}n \\
\end{matrix} \right|
\end{array}
\right) -
\color{darkorange}d \cdot
\left(
\begin{array}{cc}
\color{green}e \cdot
\left| \begin{matrix} 
  \color{red}j & \color{blue}k \\
  \color{blue}n & \color{red}o \\
\end{matrix} \right| \\-\\
\color{green}f \cdot
\left| \begin{matrix} 
  \color{red}i & \color{blue}k \\
  \color{blue}m & \color{red}o \\
\end{matrix} \right| \\+\\
\color{green}g \cdot
\left| \begin{matrix} 
  \color{red}i & \color{blue}j \\
  \color{blue}m & \color{red}n \\
\end{matrix} \right|
\end{array}
\right) \\ \LARGE \downarrow \\
\scriptsize
\color{darkorange}a \cdot 
\left(
\begin{array}{cc}
\color{green}f(\color{red}{kp} - \color{blue}{lo})
\\ - \\
\color{green}g(\color{red}{jp} - \color{blue}{ln})
\\ + \\
\color{green}h(\color{red}{jo} - \color{blue}{kn})
\end{array}
\right)
-
\color{darkorange}b \cdot 
\left(
\begin{array}{cc}
\color{green}e(\color{red}{kp} - \color{blue}{lo})
\\ - \\
\color{green}g(\color{red}{ip} - \color{blue}{lm})
\\ + \\
\color{green}h(\color{red}{io} - \color{blue}{km})
\end{array}
\right)
+
\color{darkorange}c \cdot 
\left(
\begin{array}{cc}
\color{green}e(\color{red}{jp} - \color{blue}{ln})
\\ - \\
\color{green}f(\color{red}{ip} - \color{blue}{lm})
\\ + \\
\color{green}h(\color{red}{in} - \color{blue}{jm})
\end{array}
\right)
-
\color{darkorange}d \cdot 
\left(
\begin{array}{cc}
\color{green}e(\color{red}{jo} - \color{blue}{nk})
\\ - \\
\color{green}f(\color{red}{io} - \color{blue}{km})
\\ + \\
\color{green}g(\color{red}{in} - \color{blue}{jm})
\end{array}
\right)
 \\ \LARGE \downarrow \\
\scriptsize
\color{darkorange}a(\color{green}f\color{red}{kp} - \color{green}f\color{blue}{lo} - \color{green}g\color{red}{jp} - \color{green}g\color{blue}{ln} + \color{green}h\color{red}{jo} - \color{green}h\color{blue}{kn}) 
-
\scriptsize
\color{darkorange}b(\color{green}e\color{red}{kp} - \color{green}e\color{blue}{lo} - \color{green}g\color{red}{ip} - \color{green}g\color{blue}{lm} + \color{green}h\color{red}{io} - \color{green}h\color{blue}{km}) 
\\\scriptsize+\\
\scriptsize
\color{darkorange}c(\color{green}e\color{red}{jp} - \color{green}e\color{blue}{ln} - \color{green}f\color{red}{ip} - \color{green}f\color{blue}{lm} + \color{green}h\color{red}{in} - \color{green}h\color{blue}{jm}) 
-
\scriptsize
\color{darkorange}d(\color{green}e\color{red}{jo} - \color{green}e\color{blue}{nk} - \color{green}f\color{red}{io} - \color{green}f\color{blue}{km} + \color{green}g\color{red}{in} - \color{green}g\color{blue}{jm})
$$




## R

```{r}
r_mat <- matrix(
  c(6, 1, 1,
    4, -2, 5,
    2, 8, 7),
  nrow = 3, ncol = 3, byrow = TRUE
  )
r_mat
```

### By Hand

```{r}
find_determinant <- function(x, .verbose = TRUE) {
  stopifnot(is.matrix(x) && dim(x)[[1]] == dim(x)[[2]])
  # if (all(dim(x) == 1)) return(x[1, 1])
  if (all(dim(x) == 2)) return(x[1, 1] * x[2, 2] - x[1, 2] * x[2, 1])
  out <- 0
  
  for (i in seq_len(ncol(x))) {
    if (.verbose) previous_out <- out
    
    out <- out + x[1, i] * (-1)^(1 + i) * find_determinant(x[-1, -i])
    
    if (.verbose) {
      progress <- glue::glue(
        "previous_out = {previous_out}
        i = {i}
        x[1, i] = x[1,{i}] = {x[1, i]}
        (-1)^(1 + i) = (-1)^(1 + {i}) =  {(-1)^(1 + i)}
        find_determinant(x[-1, -i]) = {find_determinant(x[-1, -i])}\n
        {previous_out} + {x[1, i]} * {(-1)^(1 + i)} * {find_determinant(x[-1, -i])} = {out}"
      )
      cat(progress, "\n\n\n")
    }
  }
  out
}

find_determinant(r_mat)
```

### Base R

```{r}
det(r_mat)
```

## Python

```{python}
np_mat = np.array([[6,  1,  1],
                   [4, -2,  5],
                   [2,  8,  7]])
print(np_mat)
```


### NumPy

```{python}
res = np.linalg.det(np_mat)
print(res)
```


## Rcpp

### RcppArmadillo

```{Rcpp, cache=TRUE}
// [[Rcpp::plugins(cpp14)]]
// [[Rcpp::depends(RcppArmadillo)]]
#include <RcppArmadillo.h>
using namespace Rcpp;

// [[Rcpp::export]]
auto cpp_determinant(NumericMatrix x) {
  auto arma_mat = as<arma::mat>(x);
  
  auto out = arma::det(arma_mat);

  return out;
}
```

```{r}
cpp_determinant(r_mat)
```




```{r child=here::here("static/R/environment-details.Rmd")}
```


